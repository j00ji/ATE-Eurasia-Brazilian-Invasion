###################################
#
# SUNSET INVASION
# - The Fantasy Menace
#
###################################

# Written by Henrik Fï¿½hraeus and Henrik Eklund

namespace = brazil_invasion

# First Contact - Beads and Feathers
# (There is another version of this event: SoA.3081 - triggered by a Demon Child.)
character_event = {
	id = brazil_invasion.1

	is_triggered_only = yes
	hide_window = yes

	only_playable = yes
	has_dlc = "Sunset Invasion"

	trigger = {
		owns = event_target:pulse_province
		year < 2950

		trigger_if = {
			limit = {
				has_game_rule = {
					name = aztec_invasion
					value = historical
				}
			}

			year >= 2850
		}
		trigger_else_if = {
			limit = {
				has_game_rule = {
					name = aztec_invasion
					value = random
				}
			}

			total_years_played >= 50
		}
		trigger_else = {
			has_game_rule = {
				name = aztec_invasion
				value = delayed_random
			}

			year >= 2600
			total_years_played >= 50
		}

		NOR = {
			has_global_flag = aztec_explorers
			has_global_flag = demon_child_to_aztecs

			has_game_rule = {
				name = aztec_invasion
				value = off
			}
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 2
			year >= 2920
		}

		mult_modifier = {
			factor = 0.25

			has_game_rule = {
				name = aztec_invasion
				value = random
			}
		}

		mult_modifier = {
			factor = 0.33

			has_game_rule = {
				name = aztec_invasion
				value = delayed_random
			}
		}

		# Prevent the randomized invasions from firing immediately after 50 years of game, see 'immediate' below
		mult_modifier = {
			factor = 0.6 # Equivalent to 40% chance of misfiring

			year < 2900
			total_years_played >= 50
			total_years_played < 100

			OR = {
				has_game_rule = {
					name = aztec_invasion
					value = random
				}

				has_game_rule = {
					name = aztec_invasion
					value = delayed_random
				}
			}
		}

		mult_modifier = {
			factor = 0.7 # Equivalent to 30% chance of misfiring

			year < 2900
			total_years_played >= 100
			total_years_played < 150

			OR = {
				has_game_rule = {
					name = aztec_invasion
					value = random
				}

				has_game_rule = {
					name = aztec_invasion
					value = delayed_random
				}
			}
		}

		mult_modifier = {
			factor = 0.85 # Equivalent to 15% chance of misfiring

			year < 2900
			total_years_played >= 150
			total_years_played < 200

			OR = {
				has_game_rule = {
					name = aztec_invasion
					value = random
				}

				has_game_rule = {
					name = aztec_invasion
					value = delayed_random
				}
			}
		}

		mult_modifier = {
			factor = 0.9625 # Equivalent to 3.75% chance of misfiring

			year < 2900
			total_years_played >= 200

			OR = {
				has_game_rule = {
					name = aztec_invasion
					value = random
				}

				has_game_rule = {
					name = aztec_invasion
					value = delayed_random
				}
			}
		}
	}

	immediate = {
		log = "BRAZILIAN INVASION IMMEDIATE brazil_invasion.1"
		set_global_flag = aztec_explorers

		activate_title = {
			title = e_zoropa
			status = yes
		}

		# Select first invasion location
		random_province = {
			limit = {
				OR = {
					province_id = c_vestisland
					province_id = c_mayo
					province_id = c_outer_hebrides
					province_id = c_cornwall
					province_id = c_cornouaille
					province_id = c_bordeaux
					province_id = c_coruna
					province_id = c_silves
					province_id = c_tangier
					province_id = c_safi
				}
			}

			set_province_flag = aztec_explorers
			save_global_event_target_as = first_aztec_invasion_target

			province_event = {
				id = brazil_invasion.3 # First Landing of the Brazilians
				years = 2
				random = 365
			}

			owner = {
				character_event = { id = brazil_invasion.74 } # Notification

				create_random_soldier = {
					dynasty = 1889999 # Cangussu
					random_traits = yes
					culture = brazilian
					religion = modernist
				}

				new_character = {
					grant_title = e_zoropa
					set_government_type = feudal_government

					add_trait = maneater

					e_zoropa = {
						add_law = succ_primogeniture
						add_law = agnatic_succession

						if = {
							limit = { has_dlc = "Conclave" }
							add_law = revoke_title_law_2
						}
						else = {
							add_law = crown_authority_1
						}
					}

					set_defacto_liege = THIS

					narrative_event = {
						id = brazil_invasion.2
						days = 7
					}
				}
			}
		}
	}
}

# Rumors of people from across the Atlantic
narrative_event = {
	id = brazil_invasion.2
	title = EVTNAME_brazil_invasion_002
	picture = GFX_evt_aztec_explorers
	border = GFX_event_narrative_frame_war

	desc = {
		text = EVTDESC_brazil_invasion_002
		trigger = {
			NOT = { has_global_flag = demon_child_to_aztecs }
		}
	}
	desc = {
		text = EVTDESC_brazil_invasion_002_DEMON
		trigger = { has_global_flag = demon_child_to_aztecs }
	}

	is_triggered_only = yes
	major = yes
	hide_from = yes

	major_trigger = {
		ai = no
	}

	immediate = {
		e_zoropa = {
			holder_scope = {
				character_event = { id = CM.10018 } # Chronicle
			}
		}
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_002
			trigger = {
				NAND = {
					has_global_flag = demon_child_to_aztecs
					society_member_of = the_satanists
				}
			}
		}
		name = {
			text = EVTOPTA_brazil_invasion_002_SATANIC
			trigger = {
				has_global_flag = demon_child_to_aztecs
				society_member_of = the_satanists
			}
		}
	}
}

# First Landing of the Brazilians
province_event = {
	id = brazil_invasion.3
	desc = EVTDESC_brazil_invasion_003
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	has_flag = aztec_explorers

	trigger = {
		NOT = { has_global_flag = aztec_arrival }
	}

	immediate = {
		set_global_flag = aztec_arrival

		province_event = {
			id = brazil_invasion.100 # Disband event fleet
			years = 50
		}

		province_event = {
			id = brazil_invasion.5 # Second Landing of the Brazilians
			years = 1
			random = 730
		}

		e_zoropa = {
			holder_scope = {
				narrative_event = { id = brazil_invasion.4 }
			}
		}
	}

	option = {
		name = EVTOPTA_brazil_invasion_003
	}
}

# First Landing of the Brazilians
narrative_event = {
	id = brazil_invasion.4
	title = EVTNAME_brazil_invasion_004
	desc = EVTDESC_brazil_invasion_004
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	major = yes
	hide_new = yes
	show_root = yes

	major_trigger = {
		NOT = { owns = FROM }
	}

	immediate = {
		any_player = {
			limit = {
				capital_scope = {
					NOT = { region = world_india }
				}
			}

			character_event = { id = CM.10020 } # Chronicle
		}

		wealth = 10000
		prestige = 500 # Enough for the first invasion

		FROM = {
			kingdom = {
				ROOT = {
					war = {
						casus_belli = tribal_invasion
						target = PREVPREV # The top liege of the province owner
						thirdparty_title = PREV # The de jure kingdom
					}
				}
			}
		}

		while = {
			count = 12

			# Spawn commanders, plus a few spares
			create_character = {
				random_traits = yes
				dynasty = random
				religion = modernist
				culture = brazilian
				female = no
				age = 18

				attributes = {
					martial = 12
				}

				add_trait = brilliant_strategist
			}

			new_character = {
				# Aged from 18 to 31
				random_list = {
					1 = { }
					1 = { add_age = 1 }
					1 = { add_age = 2 }
					1 = { add_age = 3 }
					1 = { add_age = 4 }
					1 = { add_age = 5 }
					1 = { add_age = 6 }
					1 = { add_age = 7 }
					1 = { add_age = 8 }
					1 = { add_age = 9 }
					1 = { add_age = 10 }
					1 = { add_age = 11 }
					1 = { add_age = 12 }
					1 = { add_age = 13 }
				}
			}

			# Spawn armies
			spawn_unit = {
				province = FROM
				home = FROM

				troops = {
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1400 }
					archers = { 1400 1400 }
				}
			}
		}

		# Several chances for more troops
		while = {
			count = 3

			random = {
				chance = 50

				while = {
					count = 3

					spawn_unit = {
						province = FROM
						home = FROM

						troops = {
							heavy_infantry = { 2800 2800 }
							light_infantry = { 1400 1400 }
							archers = { 1400 1400 }
						}
					}
				}
			}
		}

		# Ships
		FROM = {
			if = {
				limit = {
					OR = {
						province_id = c_vestisland
						province_id = c_mayo
						province_id = c_outer_hebrides
						province_id = c_cornwall
					}
				}

				sea_zone = {
					ROOT = {
						spawn_unit = {
							province = PREV
							home = FROM
							owner = ROOT
							earmark = aztec_invasion_fleet

							troops = {
								galleys = { 1000 1000 }
							}
						}
					}
				}
			}
		}

		# Some extra courtiers
		while = {
			count = 11

			create_character = {
				random_traits = yes
				dynasty = random
				religion = modernist
				culture = brazilian
				female = no
				age = 16
			}

			new_character = {
				# Aged from 16 to 28
				random_list = {
					1 = { }
					1 = { add_age = 1 }
					1 = { add_age = 2 }
					1 = { add_age = 3 }
					1 = { add_age = 4 }
					1 = { add_age = 5 }
					1 = { add_age = 6 }
					1 = { add_age = 7 }
					1 = { add_age = 8 }
					1 = { add_age = 9 }
					1 = { add_age = 10 }
					1 = { add_age = 11 }
					1 = { add_age = 12 }
				}
			}
		}

		while = {
			count = 7

			create_character = {
				random_traits = yes
				dynasty = random
				religion = modernist
				culture = brazilian
				female = yes
				age = 16
			}

			new_character = {
				# Aged from 16 to 20
				random_list = {
					1 = { }
					1 = { add_age = 1 }
					1 = { add_age = 2 }
					1 = { add_age = 3 }
					1 = { add_age = 4 }
				}
			}
		}
	}

	option = {
		name = EVTOPTA_brazil_invasion_004

		trigger = {
			has_power_omen_modifier_trigger = no
			has_battle_omen_modifier_trigger = no
		}
	}

	option = { # Monks & Mystics - Hermetics Scrying reaction
		name = EVTOPTA_brazil_invasion_004
		tooltip_info = yes

		trigger = {
			OR = {
				has_power_omen_modifier_trigger = yes
				has_battle_omen_modifier_trigger = yes
			}
		}

		# For the scrying outcome calculation...
		set_character_flag = negative_event_flag
		calculate_scrying_outcome_effect = yes
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Second Landing of the Brazilians
province_event = {
	id = brazil_invasion.5

	is_triggered_only = yes
	hide_window = yes

	has_global_flag = aztec_arrival

	trigger = {
		NOT = { has_global_flag = aztec_arrival_2 }
	}

	immediate = {
		set_global_flag = aztec_arrival_2

		random_province = {
			limit = {
				OR = {
					province_id = c_vestisland
					province_id = c_mayo
					province_id = c_outer_hebrides
					province_id = c_cornwall
					province_id = c_cornouaille
					province_id = c_bordeaux
					province_id = c_coruna
					province_id = c_silves
					province_id = c_tangier
					province_id = c_safi
				}

				owner = {
					NOT = { religion = modernist }
				}
			}

			save_event_target_as = aztec_second_wave

			owner = {
				character_event = { id = brazil_invasion.8 }
			}

			e_zoropa = {
				holder_scope = {
					narrative_event = { id = brazil_invasion.6 }
				}
			}
		}
	}
}

character_event = {
	id = brazil_invasion.8
	desc = EVTDESC_brazil_invasion_008
	picture = GFX_evt_aztec_arrival
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_brazil_invasion_008
	}
}

# Second Landing of the Brazilians
narrative_event = {
	id = brazil_invasion.6
	title = EVTNAME_brazil_invasion_006
	desc = EVTDESC_brazil_invasion_006
	picture = GFX_evt_aztec_arrival
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	major = yes
	hide_new = yes
	show_root = yes

	major_trigger = {
		NOT = { owns = event_target:aztec_second_wave }
	}

	immediate = {
		# Ensure the second invasion can be declared without going into negative prestige
		while = {
			limit = { prestige < 500 }
			prestige = 1
		}

		event_target:aztec_second_wave = {
			kingdom = {
				ROOT = {
					war = {
						casus_belli = tribal_invasion
						target = PREVPREV # The top liege of the province owner
						thirdparty_title = PREV # The de jure kingdom
					}
				}
			}
		}

		while = {
			count = 12

			# Spawn commanders, plus a few spares
			create_character = {
				random_traits = yes
				dynasty = random
				religion = modernist
				culture = brazilian
				female = no
				age = 18

				attributes = {
					martial = 12
				}

				add_trait = brilliant_strategist
			}

			new_character = {
				# Aged from 18 to 31
				random_list = {
					1 = { }
					1 = { add_age = 1 }
					1 = { add_age = 2 }
					1 = { add_age = 3 }
					1 = { add_age = 4 }
					1 = { add_age = 5 }
					1 = { add_age = 6 }
					1 = { add_age = 7 }
					1 = { add_age = 8 }
					1 = { add_age = 9 }
					1 = { add_age = 10 }
					1 = { add_age = 11 }
					1 = { add_age = 12 }
					1 = { add_age = 13 }
				}
			}

			# Spawn armies
			spawn_unit = {
				province = event_target:aztec_second_wave
				home = event_target:aztec_second_wave

				troops = {
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1400 }
					archers = { 1400 1400 }
				}
			}
		}

		# Several chances for more troops
		while = {
			count = 3

			random = {
				chance = 50

				while = {
					count = 3

					spawn_unit = {
						province = event_target:aztec_second_wave
						home = event_target:aztec_second_wave

						troops = {
							heavy_infantry = { 2800 2800 }
							light_infantry = { 1400 1400 }
							archers = { 1400 1400 }
						}
					}
				}
			}
		}

		# Ships
		event_target:aztec_second_wave = {
			if = {
				limit = {
					OR = {
						province_id = c_vestisland
						province_id = c_mayo
						province_id = c_outer_hebrides
						province_id = c_cornwall
					}
				}

				sea_zone = {
					ROOT = {
						spawn_unit = {
							province = PREV
							home = event_target:aztec_second_wave
							owner = ROOT
							earmark = aztec_invasion_fleet

							troops = {
								galleys = { 1000 1000 }
							}
						}
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTA_brazil_invasion_006

		trigger = {
			has_power_omen_modifier_trigger = no
			has_battle_omen_modifier_trigger = no
		}
	}

	option = { # Monks & Mystics - Hermetics Scrying reaction
		name = EVTOPTA_brazil_invasion_006
		tooltip_info = yes

		trigger = {
			OR = {
				has_power_omen_modifier_trigger = yes
				has_battle_omen_modifier_trigger = yes
			}
		}

		# For the scrying outcome calculation...
		set_character_flag = negative_event_flag
		calculate_scrying_outcome_effect = yes
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Aztec Invasion Fleets disband
province_event = {
	id = brazil_invasion.100

	is_triggered_only = yes
	hide_window = yes

	immediate = {
		set_global_flag = aztec_invasion_fleet_disbanded

		e_zoropa = {
			holder_scope = {
				disband_event_forces = aztec_invasion_fleet
			}
		}
	}
}

# Brazilians Thrown Back Into the Sea
narrative_event = {
	id = brazil_invasion.105
	title = EVTNAME_brazil_invasion_105
	desc = EVTDESC_brazil_invasion_105
	picture = GFX_evt_aztec_arrival
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes # on_unlanded; on_battle_lost_owner; on_yearly_pulse
	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival_2

	trigger = {
		has_landed_title = e_zoropa
		NOT = { has_global_flag = aztecs_defeated }
		has_regiments = no
		is_landed = no
	}

	major_trigger = {
		ai = no
	}

	immediate = {
		set_global_flag = aztecs_defeated

		activate_title = {
			title = e_zoropa
			status = no
		}
	}

	option = {
		name = EVTOPTA_brazil_invasion_105
	}
}

# Brazilians Fight Andean Powers
narrative_event = {
	id = brazil_invasion.30
	title = EVTNAME_brazil_invasion_030
	desc = EVTDESC_brazil_invasion_030
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes # on_five_year_pulse, random_events, sunset_invasion_flavour_events
	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa

		NOR = {
			has_global_flag = aztec_incas
			has_global_flag = aztecs_defeated
		}
	}

	major_trigger = {
		ai = no
	}

	immediate = {
		set_global_flag = aztec_incas
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_030
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_030
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Pacify the Northern Plains
narrative_event = {
	id = brazil_invasion.31
	title = EVTNAME_brazil_invasion_031
	desc = EVTDESC_brazil_invasion_031
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes # on_five_year_pulse, random_events, sunset_invasion_flavour_events
	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa

		NOR = {
			has_global_flag = aztec_plains
			has_global_flag = aztecs_defeated
		}
	}

	major_trigger = {
		ai = no
	}

	immediate = {
		set_global_flag = aztec_plains
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_031
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_031
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Food From the Americas
narrative_event = {
	id = brazil_invasion.35
	title = EVTNAME_brazil_invasion_035
	desc = EVTDESC_brazil_invasion_035
	picture = GFX_evt_aztec_explorers
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes # on_five_year_pulse, random_events, sunset_invasion_flavour_events
	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa

		NOR = {
			has_global_flag = aztec_food
			has_global_flag = aztecs_defeated
		}
	}

	major_trigger = {
		ai = no
	}

	immediate = {
		set_global_flag = aztec_food
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_035
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_035
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Hold Iceland
character_event = {
	id = brazil_invasion.40
	desc = EVTDESC_brazil_invasion_040
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_normal_frame_war

	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa
		NOT = { has_global_flag = aztec_iceland }
		completely_controls = d_iceland
	}

	major_trigger = {
		ai = no
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_global_flag = aztec_iceland
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_040
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_040
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Hold Ireland
character_event = {
	id = brazil_invasion.41
	desc = EVTDESC_brazil_invasion_041
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_normal_frame_war

	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa
		NOT = { has_global_flag = aztec_ireland }
		completely_controls_region = custom_ireland
	}

	major_trigger = {
		ai = no
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_global_flag = aztec_ireland
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_041
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_040
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Hold Britain
character_event = {
	id = brazil_invasion.42
	desc = EVTDESC_brazil_invasion_042
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_normal_frame_war

	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa
		NOT = { has_global_flag = aztec_britain }
		completely_controls_region = custom_great_britain
	}

	major_trigger = {
		ai = no
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_global_flag = aztec_britain
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_042
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_040
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Hold London
character_event = {
	id = brazil_invasion.43
	desc = EVTDESC_brazil_invasion_043
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_normal_frame_war

	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa
		NOT = { has_global_flag = aztec_london }
		completely_controls = c_london
	}

	major_trigger = {
		ai = no
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_global_flag = aztec_london
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_043
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_040
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Hold Paris
character_event = {
	id = brazil_invasion.44
	desc = EVTDESC_brazil_invasion_044
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_normal_frame_war

	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa
		NOT = { has_global_flag = aztec_paris }
		completely_controls = c_paris
	}

	major_trigger = {
		ai = no
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_global_flag = aztec_paris
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_043
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_040
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Hold Rome
character_event = {
	id = brazil_invasion.45
	desc = EVTDESC_brazil_invasion_045
	picture = GFX_evt_rome_falls
	border = GFX_event_normal_frame_war

	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa
		NOT = { has_global_flag = aztec_rome }
		completely_controls = c_rome
	}

	major_trigger = {
		ai = no
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_global_flag = aztec_rome
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_043
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_040
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Hold Constantinople
character_event = {
	id = brazil_invasion.46
	desc = EVTDESC_brazil_invasion_046
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_normal_frame_war

	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa
		NOT = { has_global_flag = aztec_constantinople }
		completely_controls = c_istanbul
	}

	major_trigger = {
		ai = no
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_global_flag = aztec_constantinople
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_043
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_040
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Hold Cordoba
character_event = {
	id = brazil_invasion.47
	desc = EVTDESC_brazil_invasion_047
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_normal_frame_war

	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa
		NOT = { has_global_flag = aztec_cordoba }
		completely_controls = c_madrid
	}

	major_trigger = {
		ai = no
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_global_flag = aztec_cordoba
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_043
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_040
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Hold Cairo
character_event = {
	id = brazil_invasion.48
	desc = EVTDESC_brazil_invasion_048
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_normal_frame_war

	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa
		NOT = { has_global_flag = aztec_cairo }
		completely_controls = c_al_qahirah
	}

	major_trigger = {
		ai = no
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_global_flag = aztec_cairo
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_043
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_040
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Perform Ritual Cannibalism
character_event = {
	id = brazil_invasion.60
	picture = GFX_evt_bishop_aztec
	border = GFX_event_normal_frame_war

	desc = {
		text = EVTDESC_brazil_invasion_060
		trigger = {
			OR = {
				NOT = { religion = modernist }
				NOT = { trait = maneater }
			}
		}
	}
	desc = {
		text = EVTDESC_brazil_invasion_060_B
		trigger = {
			religion = modernist
			trait = maneater
		}
	}

	is_triggered_only = yes

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_060
			trigger = {
				OR = {
					NOT = { religion = modernist }
					NOT = { trait = maneater }
				}
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_060
			trigger = {
				religion = modernist
				trait = maneater
			}
		}
	}
}

# Brazilians Perform Ritual Cannibalism on Occupied Province Character
# ROOT is local character
# FROM is lost holding title
# new_character is owner of siege winner unit
character_event = {
	id = brazil_invasion.61

	is_triggered_only = yes # on_siege_over_loc_chars
	hide_window = yes

	ai = yes
	min_age = 16
	prisoner = no
	in_command = no

	trigger = {
		new_character = {
			trait = maneater
		}

		OR = {
			NOT = { religion = modernist }
			NOT = { trait = maneater }
		}

		NOT = {
			any_liege = {
				has_landed_title = e_zoropa
			}
		}
	}

	immediate = {
		liege = {
			character_event = { id = brazil_invasion.62 }
		}

		new_character = {
			if = {
				limit = {
					ai = no
					is_ironman = yes

					ROOT = {
						controls_religion = yes
						OR = {
							NOT = { religion = modernist }
							NOT = { trait = maneater }
						}
					}
				}

				set_character_flag = achievement_holy_smoke
			}
		}

		death = { death_reason = death_execution_eaten }
	}
}
# Liege Informed of Ritual Cannibalism
character_event = {
	id = brazil_invasion.62
	desc = EVTDESC_brazil_invasion_060
	picture = GFX_evt_bishop_aztec
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_brazil_invasion_060
	}
}

# Brazilians Bring Disease
narrative_event = {
	id = brazil_invasion.70
	title = EVTNAME_brazil_invasion_070
	desc = EVTDESC_brazil_invasion_070
	picture = GFX_evt_aztec_explorers
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes # on_five_year_pulse, random_events, sunset_invasion_flavour_events
	major = yes

	only_independent = yes
	has_global_flag = aztec_arrival

	trigger = {
		has_landed_title = e_zoropa

		NOR = {
			has_global_flag = aztec_syphilis
			has_global_flag = aztecs_defeated
		}
	}

	major_trigger = {
		ai = no
	}

	immediate = {
		set_global_flag = aztec_syphilis
		activate_disease = syphilis
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_070
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_070
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Struck by Smallpox
narrative_event = {
	id = brazil_invasion.71
	title = EVTNAME_brazil_invasion_071
	desc = EVTDESC_brazil_invasion_071
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes # on_five_year_pulse, random_events, sunset_invasion_flavour_events
	major = yes

	only_independent = yes
	has_global_flag = aztec_syphilis

	trigger = {
		has_landed_title = e_zoropa

		NOR = {
			has_global_flag = aztecs_defeated
			has_global_flag = aztec_smallpox
		}
	}

	major_trigger = {
		ai = no
	}

	immediate = {
		set_global_flag = aztec_smallpox
	}

	option = {
		name = {
			text = EVTOPTA_brazil_invasion_071
			trigger = {
				NOT = { has_landed_title = e_zoropa }
			}
		}
		name = {
			text = EVTOPTB_brazil_invasion_071
			trigger = { has_landed_title = e_zoropa }
		}
	}
}

# Brazilians Perform Ritual Cannibalism (Aztec perspective)
character_event = {
	id = brazil_invasion.72
	desc = EVTDESC_brazil_invasion_072
	picture = GFX_evt_bishop_aztec
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTA_brazil_invasion_072

		FROM = {
			show_scope_change = no

			trigger_switch = {
				on_trigger = real_tier

				BARON =    { ROOT = { show_scope_change = no piety =  15 } }
				COUNT =    { ROOT = { show_scope_change = no piety =  30 } }
				DUKE =     { ROOT = { show_scope_change = no piety =  75 } }
				KING =     { ROOT = { show_scope_change = no piety = 150 } }
				EMPEROR =  { ROOT = { show_scope_change = no piety = 250 } }
				fallback = { ROOT = { show_scope_change = no piety =   5 } }
			}
		}
	}
}

# Notification event at beginning of invasion.
character_event = {
	id = brazil_invasion.74
	desc = EVTDESC_brazil_invasion_001
	picture = GFX_evt_aztec_explorers
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_brazil_invasion_001
	}
}


